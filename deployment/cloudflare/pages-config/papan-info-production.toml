# Papan Info App - Production Configuration
# Cloudflare Pages Project: papan-info-emasjid-production
# GitHub Branch: main
# Framework: Next.js

[build]
command = "pnpm install --frozen-lockfile && pnpm run build:packages && cd apps/papan-info && pnpm build && pnpm dlx @cloudflare/next-on-pages@1 --experimental-minify"
publish = "apps/papan-info/.vercel/output/static"

# Cloudflare Pages Functions configuration
[functions]
compatibility_flags = ["nodejs_compat"]
compatibility_date = "2024-01-01"

[build.environment]
NODE_ENV = "production"
NEXT_PUBLIC_SUPABASE_URL = "https://YOUR_PRODUCTION_SUPABASE_PROJECT_ID.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "YOUR_PRODUCTION_SUPABASE_ANON_KEY"
NEXT_PUBLIC_BASE_URL = "https://papan-info.emasjid.my"

# Server-side environment variables (sensitive - set in dashboard only)
# SUPABASE_SERVICE_ROLE_KEY = "set-in-cloudflare-dashboard"

# Cross-app integration (production)
NEXT_PUBLIC_HUB_URL = "https://hub.emasjid.my"
NEXT_PUBLIC_TV_DISPLAY_URL = "https://tv.emasjid.my"

# Production settings
NEXT_PUBLIC_APP_ENV = "production"
NEXT_PUBLIC_ENABLE_ANALYTICS = "true"
NEXT_PUBLIC_ENABLE_DEV_TOOLS = "false"
NEXT_PUBLIC_SHOW_LOGGER = "false"

# Papan Info specific settings
NEXT_PUBLIC_DISPLAY_NAME = "Papan Info Masjid"

# Production refresh intervals
NEXT_PUBLIC_AUTO_REFRESH = "true"
NEXT_PUBLIC_REFRESH_INTERVAL = "60000"
NEXT_PUBLIC_CONTENT_REFRESH_INTERVAL = "30000"

# Deployment tracking
# Build timestamp: Automatically set by Cloudflare
# Last deployment: Check Cloudflare dashboard

# Security headers (configured in Cloudflare dashboard)
# Content-Security-Policy, X-Frame-Options, X-Content-Type-Options, etc.

# Performance optimizations
# Node.js compatibility for Edge Functions
# Automatic minification enabled via @cloudflare/next-on-pages
# CDN caching configured in Cloudflare dashboard

# Notes:
# - This configuration is for the Papan Info PRODUCTION environment
# - All sensitive keys MUST be set in Cloudflare dashboard, NEVER commit them
# - Custom domain configured: papan-info.emasjid.my
# - SSL/TLS: Full (strict) mode enabled in Cloudflare
# - Test all changes in staging before deploying to production
# - Coordinate URL changes with hub and tv-display apps for cross-app features

# Monitoring:
# - Monitor error rates in Cloudflare Analytics
# - Check build logs for any warnings or errors
# - Verify DNS records point to Cloudflare Pages
# - Test across multiple devices and browsers

# Troubleshooting:
# - If build fails with "cp: cannot stat '.next'": Remove any manual copy commands
# - If build exceeds 25 MiB: Ensure @cloudflare/next-on-pages is used with --experimental-minify
# - For monorepo path issues: Ensure build runs from workspace root, not app directory
# - For 404 errors: Verify publish directory is apps/papan-info/.vercel/output/static
