<!DOCTYPE html>
<html>

<head>
  <title>Debug Auth Loading Issue</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .debug-info {
      background: #f0f0f0;
      padding: 10px;
      margin: 10px 0;
    }

    .error {
      background: #ffebee;
      color: #c62828;
    }

    .success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    button {
      padding: 10px;
      margin: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h1>Auth Loading Debug Tool</h1>

  <div class="debug-info">
    <h3>Browser Storage Check</h3>
    <button onclick="checkStorage()">Check Auth Storage</button>
    <button onclick="clearStorage()">Clear All Storage</button>
    <button onclick="simulateInvalidToken()">Simulate Invalid Token</button>
    <div id="storage-info"></div>
  </div>

  <div class="debug-info">
    <h3>App Test Links</h3>
    <button onclick="openApp()">Open App (New Tab)</button>
    <button onclick="openAppProfile()">Open App Profile Page</button>
    <button onclick="forceRefresh()">Force Refresh Current Page</button>
  </div>

  <div class="debug-info">
    <h3>Debug Steps</h3>
    <ol>
      <li>Check storage to see if auth token exists</li>
      <li>Open app and check if it loads properly</li>
      <li>If stuck loading, check browser console for errors</li>
      <li>Clear storage and try again</li>
    </ol>
  </div>

  <script>
    function checkStorage() {
      const info = document.getElementById('storage-info');
      let html = '<h4>LocalStorage:</h4>';

      const keys = Object.keys(localStorage);
      const authKeys = keys.filter(key =>
        key.toLowerCase().includes('supabase') ||
        key.toLowerCase().includes('auth') ||
        key.toLowerCase().includes('session') ||
        key.toLowerCase().includes('token')
      );

      if (authKeys.length === 0) {
        html += '<p class="success">No auth tokens found in localStorage</p>';
      } else {
        html += '<p class="error">Found auth-related keys:</p><ul>';
        authKeys.forEach(key => {
          const value = localStorage.getItem(key);
          const preview = value ? (value.length > 100 ? value.substring(0, 100) + '...' : value) : 'null';
          html += `<li><strong>${key}:</strong> ${preview}</li>`;
        });
        html += '</ul>';
      }

      html += '<h4>SessionStorage:</h4>';
      const sessionKeys = Object.keys(sessionStorage);
      const sessionAuthKeys = sessionKeys.filter(key =>
        key.toLowerCase().includes('supabase') ||
        key.toLowerCase().includes('auth') ||
        key.toLowerCase().includes('session') ||
        key.toLowerCase().includes('token')
      );

      if (sessionAuthKeys.length === 0) {
        html += '<p class="success">No auth tokens found in sessionStorage</p>';
      } else {
        html += '<p class="error">Found auth-related keys:</p><ul>';
        sessionAuthKeys.forEach(key => {
          const value = sessionStorage.getItem(key);
          const preview = value ? (value.length > 100 ? value.substring(0, 100) + '...' : value) : 'null';
          html += `<li><strong>${key}:</strong> ${preview}</li>`;
        });
        html += '</ul>';
      }

      info.innerHTML = html;
    }

    function clearStorage() {
      localStorage.clear();
      sessionStorage.clear();
      document.getElementById('storage-info').innerHTML = '<p class="success">All storage cleared!</p>';
    }

    function simulateInvalidToken() {
      // Add an invalid Supabase auth token to localStorage
      const invalidAuth = {
        access_token: 'invalid_token_' + Date.now(),
        token_type: 'bearer',
        user: { id: 'invalid_user_id' },
        expires_at: Date.now() / 1000 + 3600
      };
      localStorage.setItem('sb-localhost-auth-token', JSON.stringify(invalidAuth));
      document.getElementById('storage-info').innerHTML = '<p class="error">Invalid token simulated. Now try opening the app.</p>';
    }

    function openApp() {
      window.open('http://localhost:3000', '_blank');
    }

    function openAppProfile() {
      window.open('http://localhost:3000/profile', '_blank');
    }

    function forceRefresh() {
      if (window.opener) {
        window.opener.location.reload();
      } else {
        alert('No parent window to refresh');
      }
    }

    // Auto-check storage on load
    window.onload = checkStorage;
  </script>
</body>

</html>