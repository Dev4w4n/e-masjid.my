<!DOCTYPE html>
<html>

<head>
  <title>Logout Functionality Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .test-section {
      background: #f5f5f5;
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
    }

    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
    }

    .error {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
    }

    .info {
      background: #d1ecf1;
      border-left: 4px solid #17a2b8;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 3px;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    .status {
      font-weight: bold;
      padding: 5px;
      margin: 5px 0;
    }
  </style>
</head>

<body>
  <h1>üîê Logout Functionality Test</h1>

  <div class="test-section info">
    <h3>Test Instructions:</h3>
    <ol>
      <li>Click "Open App" to open the application</li>
      <li>Sign in to the application if not already signed in</li>
      <li>Once signed in, click the profile icon in the top-right corner</li>
      <li>Click "Sign Out" from the dropdown menu</li>
      <li>Verify that you are redirected to the sign-in page</li>
      <li>Check that auth tokens are cleared from browser storage</li>
    </ol>
  </div>

  <div class="test-section">
    <h3>Quick Actions:</h3>
    <button onclick="openApp()">üöÄ Open App</button>
    <button onclick="openSignIn()">üìù Open Sign In Page</button>
    <button onclick="checkAuthTokens()">üîç Check Auth Tokens</button>
    <button onclick="clearAllTokens()">üóëÔ∏è Clear All Tokens</button>
  </div>

  <div class="test-section">
    <h3>Auth Token Status:</h3>
    <div id="token-status">Click "Check Auth Tokens" to see current status</div>
  </div>

  <div class="test-section">
    <h3>Expected Logout Behavior:</h3>
    <ul>
      <li>‚úÖ User should be immediately redirected to /auth/signin</li>
      <li>‚úÖ All Supabase auth tokens should be cleared from localStorage</li>
      <li>‚úÖ User state should become null</li>
      <li>‚úÖ Profile data should be cleared</li>
      <li>‚úÖ Any protected pages should redirect to signin</li>
    </ul>
  </div>

  <div class="test-section">
    <h3>Debug Information:</h3>
    <div id="debug-info">
      <p>Open browser developer console to see detailed auth logs</p>
      <p>Look for messages like:</p>
      <ul>
        <li>"Signing out user..."</li>
        <li>"AuthProvider: Signing out user"</li>
        <li>"Auth state change: SIGNED_OUT"</li>
      </ul>
    </div>
  </div>

  <script>
    function openApp() {
      window.open('http://localhost:3002', '_blank');
    }

    function openSignIn() {
      window.open('http://localhost:3002/auth/signin', '_blank');
    }

    function checkAuthTokens() {
      const statusDiv = document.getElementById('token-status');
      let html = '';

      // Check localStorage
      const localKeys = Object.keys(localStorage).filter(key =>
        key.toLowerCase().includes('supabase') ||
        key.toLowerCase().includes('auth') ||
        key.toLowerCase().includes('sb-')
      );

      // Check sessionStorage
      const sessionKeys = Object.keys(sessionStorage).filter(key =>
        key.toLowerCase().includes('supabase') ||
        key.toLowerCase().includes('auth') ||
        key.toLowerCase().includes('sb-')
      );

      if (localKeys.length === 0 && sessionKeys.length === 0) {
        html = '<div class="status success">‚úÖ No auth tokens found - User is logged out</div>';
      } else {
        html = '<div class="status error">‚ùå Auth tokens still present:</div>';

        if (localKeys.length > 0) {
          html += '<p><strong>localStorage:</strong></p><ul>';
          localKeys.forEach(key => {
            const value = localStorage.getItem(key);
            const preview = value && value.length > 50 ? value.substring(0, 50) + '...' : value;
            html += `<li>${key}: ${preview}</li>`;
          });
          html += '</ul>';
        }

        if (sessionKeys.length > 0) {
          html += '<p><strong>sessionStorage:</strong></p><ul>';
          sessionKeys.forEach(key => {
            const value = sessionStorage.getItem(key);
            const preview = value && value.length > 50 ? value.substring(0, 50) + '...' : value;
            html += `<li>${key}: ${preview}</li>`;
          });
          html += '</ul>';
        }
      }

      statusDiv.innerHTML = html;
    }

    function clearAllTokens() {
      // Clear all storage
      localStorage.clear();
      sessionStorage.clear();

      // Clear cookies (basic attempt)
      document.cookie.split(";").forEach(function (c) {
        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
      });

      document.getElementById('token-status').innerHTML =
        '<div class="status success">‚úÖ All tokens cleared manually</div>';
    }

    // Auto-check tokens on page load
    window.addEventListener('load', checkAuthTokens);

    // Auto-refresh token status every 2 seconds
    setInterval(checkAuthTokens, 2000);
  </script>
</body>

</html>